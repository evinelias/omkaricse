generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


enum Role {
  SUPER_ADMIN
  USER
}

model Admin {
  id          Int      @id @default(autoincrement())
  email       String   @unique
  password    String
  name        String   @default("Admin")
  role        Role     @default(SUPER_ADMIN)
  permissions String[] @default([]) // e.g. ["LEADS", "EMAIL", "USERS", "ACTIVITY"]
  isFrozen    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt @default(now())
  
  activityLogs ActivityLog[]
  remarks      LeadRemark[]
}

model Lead {
  id             Int      @id @default(autoincrement())
  name           String   // Parent/Guardian Name
  studentName    String?  // Student Name
  email          String
  phone          String
  source         String   // "popup", "contact", "social_media", etc.
  inquiryType    String?  // "Admissions Inquiry", "General", etc.
  message        String?
  grade          String?
  city           String?
  status         String   @default("NEW") // "NEW", "CONTACTED", "QUALIFIED", "UNQUALIFIED"
  lastModifiedBy String?  // Name of the admin who last modified this lead
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt @default(now())

  remarks        LeadRemark[]

  @@index([email])
  @@index([status])
  @@index([createdAt])
}

model EmailConfig {
  id              Int      @id @default(autoincrement())
  receiverEmails  String[] @default(["admin@omkaricse.in"])
  mailjetApiKey   String?
  mailjetSecret   String?
  isEnabled       Boolean  @default(true)
}

model EmailLog {
  id        Int      @id @default(autoincrement())
  recipient String
  subject   String
  status    String   // "SUCCESS" | "FAILED"
  error     String?
  sentAt    DateTime @default(now())
}

model ActivityLog {
  id        Int      @id @default(autoincrement())
  adminId   Int
  admin     Admin    @relation(fields: [adminId], references: [id])
  action    String   // e.g. "LOGIN", "UPDATE_LEAD", "CREATE_USER"
  details   String?  // JSON string or description
  ipAddress String?
  createdAt DateTime @default(now())

  @@index([adminId])
  @@index([createdAt])
}

model LeadRemark {
  id        Int      @id @default(autoincrement())
  leadId    Int
  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  adminId   Int
  admin     Admin    @relation(fields: [adminId], references: [id])
  remark    String
  createdAt DateTime @default(now())
  
  @@index([leadId])
}
